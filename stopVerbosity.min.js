(function(e,t,n,r){"use strict";function o(t,n){this.element=t;this.options=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="stopVerbosity",s={limit:300,indicatorPosition:"after",indicatorId:"countdown-indicator",indicatorElementType:"p",indicatorPhrase:["Used","[countup]","of","[limit]","characters.","[countdown]","characters remaining."],customIndicator:"",generateIndicator:true,showIndicator:true};o.prototype={init:function(){var t=o.prototype,n=this.options,r=e(this.element),i=n.limit;var s=t.setupActions().init(r,n);t.eventsActions(r).init(i,s)},setupActions:function(){var t=function(){};t.prototype={init:function(e,n){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(e){if(this==null){throw new TypeError}var t=Object(this);var n=t.length>>>0;if(n===0){return-1}var r=0;if(arguments.length>1){r=Number(arguments[1]);if(r!=r){r=0}else if(r!=0&&r!=Infinity&&r!=-Infinity){r=(r>0||-1)*Math.floor(Math.abs(r))}}if(r>=n){return-1}var i=r>=0?r:Math.max(n-Math.abs(r),0);for(;i<n;i++){if(i in t&&t[i]===e){return i}}return-1}}e.val("");var r=n.limit,i=n.indicatorPosition,s=n.indicatorId,o=n.indicatorElementType,u=n.indicatorPhrase,a=n.customIndicator,f=n.generateIndicator,l=n.showIndicator;var c=t.prototype;c.checkLimitOption(r);c.setIndicator(r,o,s,i,u,e,a,f,l);return c.setupDataStore},checkLimitOption:function(e){if(typeof e!=="number"){throw"Text limit is not a number."}},setIndicator:function(t,n,r,i,s,o,u,a,f){function c(e,t,n,r){var i=n.indexOf(t);if(i>-1){r.setupDataStore[e].push(i)}}if(!f){return}var l=this;c("limit","[limit]",s,l);c("countup","[countup]",s,l);c("countdown","[countdown]",s,l);s[this.setupDataStore.limit]=t;s[this.setupDataStore.countup]=0;s[this.setupDataStore.countdown]=t;this.setupDataStore.indicatorPhrase=s;if(Object.prototype.toString.call(u)==="[object String]"){{try{var h=e(u);if(h.length){this.setupDataStore.indicatorElement=h;h.html(s.join(" "));a=false}}catch(p){throw"Indicator element not found."}}}if(a){var d;if(r.length>0){d=" id="+r}else{d=""}var v=["<",n,d,">",s.join(" "),"</",n,">"].join(""),m=["Not a valid position for indicator,","only accepts ","'before'"," or ","'after'"].join("");if(i==="after"){o.after(v);this.setupDataStore.indicatorElement=o.next()}else if(i==="before"){o.before(v);this.setupDataStore.indicatorElement=o.prev()}else{throw m}}},setupDataStore:{limit:[],countup:[],countdown:[]}};return t.prototype},eventsActions:function(e){var t=function(){},r=t.prototype={init:function(e,t){r.addListeners(e,t)},addListeners:function(t,i){var s=this.dataStore;s.eP=r;s.el=e;s.limit=t;s.indicator=i;var o={preventFunction:function(){var t=r.dataStore.eventPrevent.indexOf("keydown");if(t===-1){r.setDataStore("eventPrevent","keydown");r.removeDataStore("eventPresent","keydown");e.off("keydown");r.keydownFunction.keydownPrevent();r.pastePreventFunction(e,r)}},allowFunction:function(){var t=r.dataStore.eventPrevent.indexOf("keydown");if(t>-1){r.removeDataStore("eventPrevent","keydown");r.setDataStore("eventPresent","keydown");e.off("keydown").off("paste");r.keydownFunction(e,r)}},changeText:function(n){var i=r.dataStore.indicator,s=i[n];if(typeof s!=="undefined"){if(s.length){var o=null;if(n==="countdown"){o=t-r.getTextAreaLength(e)}else if(n==="countup"){o=r.getTextAreaLength(e)}var u=i[n][0];i.indicatorPhrase[u]=o;var a=i.indicatorPhrase;i.indicatorElement.html(a.join(" "))}}}};var u=n.createElement("textarea"),a;if("oninput"in u&&(!("documentMode"in n)||n.documentMode>9)){a=false}else if("onpropertychange"in u){a=true}s.checkFirstKeyDown=a;if(!!("maxLength"in u)){e.attr("maxlength",t)}r.setInputSelection.offsetToRangeCharacterMove=function(e,t){return t-(e.value.slice(0,t).split("\r\n").length-1)};r.deselectFunction(o);r.selectFunction(o);r.dropFunction();r.inputFunction(o);r.trackSelectionEventsFunction();r.mousedownFunction();r.clickFunction();r.keydownFunction()},inputFunction:function(t){var n=r.dataStore;e.on("input propertychange",function(){n.checkFirstKeyDown=false;if(r.dataStore.dropOccurred){r.dataStore.dropOccurred=false;return}var i=n.limit,s=r.checkLimit(e,i);r.setDataStore("textStatus",s);if(s==="less"){if(n.falsePositive){t.allowFunction()}t.changeText("countdown");t.changeText("countup");r.setDataStore("lengthText",r.getTextAreaLength(e));setTimeout(function(){r.trackSelectionFunction(e,r)})}else if(s==="equal"){if(n.falsePositive){t.preventFunction()}t.changeText("countdown");t.changeText("countup");r.setDataStore("lengthText",r.getTextAreaLength(e));setTimeout(function(){r.trackSelectionFunction(e,r);if(n.falsePositive){if(typeof r.dataStore.newCaretPos==="number"){var t=r.dataStore.newCaretPos;r.setInputSelection(e,t,t);r.dataStore.newCaretPos=null}}})}else if(s==="greater"){n.falsePositive=true;var o=r.getTextAreaLength(e),u=n.caretStatus,a=u.start,f=u.end,l=n.lengthText,c=i-l,h=r.getText(e);var p,d,v,m;if(r.dataStore.isTextSelected){p=u.end;v=u.end;m=c+f;d=o-(l-f)}else{p=a;v=a;m=c+a;d=o-(l-a)}var g=h.slice(0,p),y=h.slice(v,m),b=h.slice(d,o),w=g+y+b,E=g.length+y.length;r.dataStore.newCaretPos=E;e.val(w);e.trigger("propertychange")}})},dropFunction:function(){var t=r.dataStore;e.on("drop",function(){r.dataStore.dropOccurred=true;setTimeout(function(){r.trackSelectionFunction(e,r);var n=t.caretStatus,i=n.start,s=n.end,o;if(i!==s){t.caretStatus.start=i;t.caretStatus.end=i;o=s}else{var u=t.lengthText,a=e.val().length-u,f=i-a;t.caretStatus.start=f;t.caretStatus.end=f;o=i}r.setInputSelection(e,o,o);r.dataStore.dropOccurred=false;e.trigger("input")})})},pastePreventFunction:function(){e.on("paste",function(e){r.negateEvent(e)})},deselectFunction:function(t){e.on("deselect",function(){var n=r.dataStore.limit,i=r.checkLimit(e,n);if(i==="equal"){t.preventFunction()}})},selectFunction:function(t){e.on("select",function(){if(r.dataStore.dropOccurred){return}r.trackSelectionFunction(e,r);var n=r.dataStore.caretStatus,i=r.dataStore.limit,s=r.checkLimit(e,i);if(s==="equal"){if(n.end===n.start){t.preventFunction()}else{t.allowFunction()}}})},trackSelectionEventsFunction:function(){e.on("mouseout focus blur",function(){setTimeout(function(){r.trackSelectionFunction(e,r)})})},mousedownFunction:function(){e.on("mousedown",function(){r.setDataStore("isMouseDown",true)})},clickFunction:function(){e.on("click",function(){setTimeout(function(){r.trackSelectionFunction(e,r)});r.setDataStore("isMouseDown",false)})},keydownFunction:function(){var t=r.dataStore;this.keydownFunction.checkFirstKeyDown=function(n){if(t.checkFirstKeyDown){if(t.continueKeyCheck){setTimeout(function(){if(r.getTextAreaLength(e)>0){e.trigger("propertychange")}})}}if(n==="keyprevent"){setTimeout(function(){e.trigger("propertychange")})}};this.keydownFunction.checkTab=function(e){if(e.which===9){if(r.dataStore.isMouseDown){r.negateEvent(e);return true}}};this.keydownFunction.keydownPrevent=function(){e.on("keydown",function(n){if(/^(0|8|9|16|17|18|19|20|27|33|34|35|36|37|38|38|40|45|46|112|113|114|115|116|117|118|119|120|121|122|123)$/.test(n.which)){r.keydownFunction.checkTab(n);r.keydownFunction.checkFirstKeyDown("keyprevent");t.falsePositive=true}else if(n.ctrlKey===false){n.preventDefault()}setTimeout(function(){r.trackSelectionFunction(e,r)})})};e.on("keydown",function(t){r.keydownFunction.checkTab(t);r.keydownFunction.checkFirstKeyDown();setTimeout(function(){r.trackSelectionFunction(e,r)})})},dataStore:{newCaretPos:null,caretStatus:{start:0,end:0},dropOccurred:false,isMouseDown:false,isTextSelected:false,isLimitReached:false,textStatus:null,lengthText:0,keyDownPresent:false,click:false,eventPresent:["keydown"],eventPrevent:[],falsePositive:false,checkFirstKeyDown:false,continueKeyCheck:true},removeDataStore:function(e,t){var n=this.dataStore[e],r=n.indexOf(t);n.splice(r,1)},setDataStore:function(e,t){if(this.dataStore[e]instanceof Array){this.dataStore[e].push(t)}else{this.dataStore[e]=t}},negateEvent:function(e){e.preventDefault();e.stopPropagation()},isTextSelected:function(e){if(Math.abs(e.start-e.end)>0){return true}},setSelectionStatus:function(){var e=this.dataStore;e.caretStatus=e.eP.getInputSelection(e.el);if(e.eP.isTextSelected(e.caretStatus)){this.setDataStore("isTextSelected",true)}else{this.setDataStore("isTextSelected",false)}},trackSelectionFunction:function(e,t){var n=t.dataStore.isTextSelected;t.setSelectionStatus();var r=t.dataStore.isTextSelected;if(n&&r===false){e.trigger("deselect")}},getText:function(e){return e.val()},getTextAreaLength:function(e){return this.getText(e).length},checkLimit:function(e,t){var n=this.getTextAreaLength(e);if(n>t){return"greater"}else if(n===t){return"equal"}else if(n<t){return"less"}},setInputSelection:function(e,t,n){var r=this.setInputSelection;var i=e[0];if(typeof i.selectionStart==="number"&&typeof i.selectionEnd==="number"){i.selectionStart=t;i.selectionEnd=n}else{var s=i.createTextRange();var o=r.offsetToRangeCharacterMove(i,t);s.collapse(true);if(t===n){s.move("character",o)}else{s.moveEnd("character",r.offsetToRangeCharacterMove(i,n));s.moveStart("character",o)}s.select()}},getInputSelection:function(e){var t=0,r=0,i,s,o,u,a,f=e[0];if(typeof f.selectionStart==="number"&&typeof f.selectionEnd==="number"){t=f.selectionStart;r=f.selectionEnd}else{s=n.selection.createRange();if(s&&s.parentElement()===f){u=f.value.length;i=f.value.replace(/\r\n/g,"\n");o=f.createTextRange();o.moveToBookmark(s.getBookmark());a=f.createTextRange();a.collapse(false);if(o.compareEndPoints("StartToEnd",a)>-1){t=r=u}else{t=-o.moveStart("character",-u);t+=i.slice(0,t).split("\n").length-1;if(o.compareEndPoints("EndToEnd",a)>-1){r=u}else{r=-o.moveEnd("character",-u);r+=i.slice(0,r).split("\n").length-1}}}}return{start:t,end:r}}};return t.prototype}};e.fn[i]=function(t){return this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}})}})(jQuery,window,document)
